<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>PHPBean-官方网站</title>
    <!-- 为了兼容部署环境，统一使用相对路径 -->
    <link href="/foreground/frame/bootstrap3/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="/foreground/frame/jquery/jquery-2.0.3.js"></script>
    <script src="/foreground/frame/bootstrap3/js/bootstrap.min.js"></script>
    <style>

    </style>
</head>

<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Developer：CheneyXu &nbsp;&nbsp;&nbsp;&nbsp; Contact：457299596@qq.com</a>
            </div>
        </div>
    </div>
    <div class="container" style="margin-top: 50px">
        <div class="page-header">
            <h1>状态机使用指南</h1>
        </div>
        <p class="lead">状态机是一系列的状态流转和动作执行的引擎，用以在复杂业务逻辑的操作时替代Service，在PHPBean中使用状态机是极其简单的</p>

        <blockquote>1、配置module/sys_module_manager/config/status.xml下的状态机文件</blockquote>
<pre>
    statusMap标签下包含了多个module，每个module的name属性对呀module的文件夹名称，entity属性对呀module的实体类名称；
    status标签包含多个operate，status的pre属性是前置状态，name属性是状态名；
    operate标签内容映射module/prefix_module_name/plugin/路径下插件类
    每个状态被执行时，其下的所有插件会被依次执行，前一个插件的出参会作为下一个插件的入参
</pre>
        <blockquote>2、导入状态机</blockquote>
<pre>
include_once BASEURL . 'background/module/module_manager/controller/StatusEngine.php'
</pre>
        <blockquote>3、校验状态，<code>$entity->status</code>中设置下一个状态，其余属性设置查询条件，前置状态包含当前查询状态，则校验通过</blockquote>
<pre>
$checkResult = StatusEngine::checkStatus ( $entity )
</pre>
        <blockquote>4、状态变更，<code>$entity->status</code>中设置下一个状态，<code>$entity->id</code>中设置数据对象id</blockquote>
<pre>
$changeResult = StatusEngine::changeStatus ( $inparam, $entity )
</pre>

        <p>返回 <a href="/index.html">首页</a></p>
        <hr>
        <footer>
            <p>&copy; CheneyXu 2017</p>
        </footer>
    </div>
</body>

</html>
